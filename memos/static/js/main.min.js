$.getJSON("_getmemos",{},function(e){rsl=e.result.memos;var t,n=moment();for(i=0;i<rsl.length;i++){title=rsl[i].title,date=moment.unix(rsl[i].date).local(),t=n.diff(date,"days"),date=date.format(),console.log("Got a day! It's "+t);var a="";has_login&&(a+='<input type="checkbox" name="memo_selected">'),a+="<label hidden>"+title+"</label>",a+="<label hidden>"+date+"</label>",a+='<button name="details_view" onclick="show_details(this)" class="link"><label>'+title+"</label></button>",a+="<label>"+date+"</label><br>",0==t?$("#today").append(a):t<0?$("#incoming").append(a):$("#past").append(a)}});function load_date_time(e,t,n,a,m,i){$("#setting_date").append("<label>Memo Date</label>"),$("#setting_date").append('<input type=number name="memo_year" id="memo_year" value='+e+' min="1970" max="2032"  />'),$("#setting_date").append('<input type=number name="memo_month" id="memo_month" value='+t+' min="1" max="12" />'),$("#setting_date").append('<input type=number name="memo_day" id="memo_day" value='+n+' min="1" max="31" />'),$("#setting_date").append('<input type=number name="memo_hour" id="memo_hour" value='+a+' min="0" max="23"  />'),$("#setting_date").append('<input type=number name="memo_min" id="memo_min" value='+m+' min="0" max="59"  />'),$("#setting_date").append('<input type=number name="memo_sec" id="memo_sec" value='+i+' min="0" max="59"  />')}function load_text_area(){$("#main_input").append('<input type="text" name="memo_title" id="memo_title" placeholder="title" autofocus /><br>'),$("#main_input").append('<textarea rows="4" style="height:400px;width:600px;" name="input_memo" id="input_memo" placeholder="body"/>')}function show_details(e){var t=$(e).text(),n=$(e).next("label").text();console.log(t,n),$.getJSON("_getDetailedMemo",{date_time:n,memo_title:t},function(e){if(rsl=e.result.memos,$("#temp_window").html('<div class="row"><p id="main_input"></p></p></div>'),$("#main_input").append('<input type="text" name="memo_title" id="memo_title"><br><div id="Body_article"></div>'),$("#memo_title").val(rsl.title),"text"in rsl){var t=new showdown.Converter({extensions:["table"]}).makeHtml(rsl.text);$("#Body_article").html(t)}$("#dialog").dialog({resizable:!1,height:"auto",width:"auto",title:"Details",buttons:{}})})}$(document).ready(function(){$("#Delete_selected_memos").click(function(){var e={};$('input[name="memo_selected"]:checked').each(function(){var t=$(this).next("label").text();$(this).next("label").remove();var n=$(this).next("label").text();n=moment(n,"YYYY-MM-DD HH:mm:ss").unix(),e[n]=t}).promise().done($.ajax({type:"POST",contentType:"application/json",url:"_delmemos",dataType:"json",data:JSON.stringify(e),error:function(e){console.log(e)},success:function(e){location.reload()}}))}),$("#check_all").click(function(){$('input[name="memo_selected"]').length==$('input[name="memo_selected"]:checked').length?$('input[name="memo_selected"]').prop("checked",!1):$('input[name="memo_selected"]').prop("checked",!0)}),$("#Add_memo").click(function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),m=e.getHours(),i=e.getMinutes(),o=e.getSeconds();a<10&&(a="0"+a),n<10&&(n="0"+n),m<10&&(m="0"+m),i<10&&(i="0"+i),$("#temp_window").html('<div class="row"><p id="setting_date" /></div>'),$("#temp_window").append('<div class="row"><p id="main_input" /></div>'),$("#temp_window").append('<div id="result" name="result" />'),load_date_time(t,n,a,m,i,o),load_text_area(),$("#dialog").dialog({resizable:!0,autoResize:!0,height:"auto",width:"auto",title:"Add a memo",cache:!1,buttons:{Preview:function(){console.log("Rendering!");var e=$("#input_memo").val(),t=new showdown.Converter({extensions:["table"]}).makeHtml(e);$("#result").html(t)},Submit:function(){var e=$("#memo_year").val()+"-"+$("#memo_month").val()+"-"+$("#memo_day").val()+" "+$("#memo_hour").val()+":"+$("#memo_min").val()+":"+$("#memo_sec").val();e=moment(e,"YYYY-MM-DD HH:mm:ss").unix(),$.getJSON("_sendmemo",{date_time:e,title:$("#memo_title").val(),memo:$("#input_memo").val()},function(e){window.location.reload(!0)})}}})})});